import{b as me,d as Te,f as C,a as y,c as He,t as Ie}from"./BUZbryMm.js";import{o as ue,a as Oe}from"./4jbtY418.js";import{t as B,o as ge,q as _e,T as Ee,aH as ze,G as be,ad as Le,aw as Ne,aD as je,ax as Me,x as We,a4 as U,p as se,aI as X,R as H,i as a,aJ as we,aK as G,a1 as P,Q as fe,d as he,a as le,aG as Z,aL as Ae,c as L,aM as ce,r as I,s as x,a3 as J,aN as Pe,f as K,aO as Be,al as Fe,a2 as Ge}from"./DWiZYpet.js";import{e as F,r as ke,d as pe,s as te}from"./CFvLA3fr.js";import{i as q}from"./B74O6qzc.js";import{j as n,i as $,k as ee,w as qe,s as ae,x as Je,y as xe,h as Ke,H as Qe}from"./DFZiEV79.js";import{s as de}from"./CmwTQ-zq.js";import{b as V,p as N}from"./CHfJkDV0.js";import{w as Y,a as re,g as Ve}from"./CqWMDBEw.js";import{b as Se}from"./CtmmS_1l.js";import{p as ve}from"./Dp63dLkR.js";function Ce(M,t,k=!1,l=!1,u=!1){var o=M,m="";B(()=>{var g=Ee;if(m===(m=t()??"")){ge&&_e();return}if(g.nodes!==null&&(ze(g.nodes.start,g.nodes.end),g.nodes=null),m!==""){if(ge){be.data;for(var f=_e(),p=f;f!==null&&(f.nodeType!==Le||f.data!=="");)p=f,f=Ne(f);if(f===null)throw je(),Me;me(be,p),o=We(f);return}var R=m+"";k?R=`<svg>${R}</svg>`:l&&(R=`<math>${R}</math>`);var _=Te(R);if((k||l)&&(_=U(_)),me(U(_),_.lastChild),k||l)for(;U(_);)o.before(U(_));else o.before(_)}})}var Ye=C('<img class="enhanced-img svelte-4bobb7"/>'),Ue=C("<source/>"),Xe=C('<picture><!> <img class="enhanced-img svelte-4bobb7"/></picture>'),Ze=C('<div class="container svelte-4bobb7"><map><!></map> <!> <canvas style="pointer-events: none" class="svelte-4bobb7"></canvas> <span class="svelte-4bobb7"></span></div>');function $e(M,t){se(t,!0);let k=1,l=null,u=P(null),o=null;const m=Y(k);X("ratioStore",m);const g=Y(l);if(X("canvasStore",g),g.subscribe(e=>{e&&H(f,[...a(f)],!0)}),we("pageCanvas")){const e=G("pageCanvas");g.subscribe(s=>e.set(s))}if(we("pageRatio")){const e=G("pageRatio");m.subscribe(s=>e.set(s))}let f=P(fe([])),p=Y([]);X("drawCallbacks",p),p.subscribe(e=>{H(f,e,!0)}),he(()=>{if(!l){console.warn("no canvas found");return}const e=l.getContext("2d");if(!e){console.warn("no context found");return}e.clearRect(0,0,l.width,l.height),a(f).forEach(s=>s(e))});let R,_=P(!1),O=P(!1),h=P(!1),D=P(!1);const c=()=>{if(!o)throw new Error("img not found");a(_)&&(H(h,o.scrollLeft!=0),H(D,o.scrollLeft+o.clientWidth<o.scrollWidth))},d=()=>{var e;j(t.picture.img.w,((e=a(u))==null?void 0:e.width)||t.picture.img.w),l&&(l.width=a(u).width,l.height=a(u).height),o&&(o.scrollWidth>o.clientWidth?(H(_,!0),H(O,!1)):o.scrollHeight>o.clientHeight&&(H(_,!1),H(O,!0)),c())},j=(e,s)=>{k=e/(s||1),m.set(k)};ue(()=>{const e=()=>{a(u)?d():Z().then(e)};e();const s=()=>{l?g.set(l):Z().then(s)};s(),Z().then(()=>{console.log("updating draw callbacks"),p.update(T=>[...T])})});var S=Ze();F("resize",Ae,d);var v=L(S),W=L(v);de(W,()=>t.children??ce),I(v);var E=x(v,2);{var b=e=>{var s=Ye();V(s,T=>H(u,T),()=>a(u)),B(()=>{n(s,"src",t.picture.img.src),n(s,"title",t.title),n(s,"alt",t.title),n(s,"usemap",`#${t.mapId??""}`),n(s,"width",t.picture.img.w),n(s,"height",t.picture.img.h)}),F("load",s,d),F("resize",s,d),ke(s),y(e,s)},w=e=>{var s=Xe(),T=L(s);$(T,17,()=>Object.entries(t.picture.sources),ee,(Q,ie)=>{var A=J(()=>Pe(a(ie),2));let ne=()=>a(A)[0],De=()=>a(A)[1];var oe=Ue();B(()=>{n(oe,"srcset",De()),n(oe,"type","image/"+ne())}),y(Q,oe)});var z=x(T,2);V(z,Q=>H(u,Q),()=>a(u)),I(s),B(()=>{n(z,"src",t.picture.img.src),n(z,"title",t.title),n(z,"alt",t.title),n(z,"usemap",`#${t.mapId??""}`),n(z,"width",t.picture.img.w),n(z,"height",t.picture.img.h)}),F("load",z,d),F("resize",z,d),ke(z),y(e,s)};q(E,e=>{typeof t.picture=="string"?e(b):e(w,!1)})}var i=x(E,2);V(i,e=>l=e,()=>l);var r=x(i,2);V(r,e=>R=e,()=>R),I(S),V(S,e=>o=e,()=>o),B(()=>{n(S,"data-left",a(h)),n(S,"data-right",a(D)),n(v,"name",t.mapId),n(i,"width",t.picture.img.w),n(i,"height",t.picture.img.h)}),F("scroll",S,c),y(M,S),le()}const ye=M=>{};var et=C('<area shape="poly"/>');function Re(M,t){se(t,!0);const k=N(t,"href",3,""),l=N(t,"title",3,""),u=N(t,"coords",19,()=>[]),o=N(t,"onclick",3,()=>{}),m=N(t,"pinned",11,!1);let g=P(1);const f=G("ratioStore");let p=P(null);const R=G("canvasStore"),_=G("drawCallbacks"),O=r=>{qe(r,a(d),t.setStyle)};O.title=l();const h=()=>{_.update(r=>r.filter(e=>e!==O).concat([O]))},D=()=>{_.update(r=>r.filter(e=>e!==O))};Oe(()=>D());let c=P(fe([...u()])),d=J(()=>a(c).map(r=>r.map(e=>e/a(g)))),j=J(()=>a(d).map(r=>r.join(",")).join(","));f.subscribe(r=>H(g,r,!0)),R.subscribe(r=>H(p,r,!0));const S=()=>h(),v=()=>{m()||D()};he(()=>{m()?h():D()}),Y(u()).subscribe(r=>H(c,r,!0));const E=G("side"),b=ye,w=r=>{r.preventDefault(),E&&E.set(b)};var i=et();i.__click=function(...r){var e;(e=o())==null||e.apply(this,r)},i.__contextmenu=w,B(()=>{n(i,"coords",a(j)),n(i,"alt",l()),n(i,"title",l()),n(i,"href",k()),n(i,"data-ratio",a(g)),n(i,"data-side-defined",!!ye)}),F("mouseenter",i,S),F("mouseleave",i,v),y(M,i),le()}pe(["click","contextmenu"]);var tt=C("by <em> </em>",1),at=C("<span>ðŸŒŸ (recommended)</span>"),rt=C("<div><h1> </h1> <p><!> <!></p> <!></div>");function st(M,t){se(t,!0);const k=c=>{var d=rt(),j=L(d),S=L(j,!0);I(j);var v=x(j,2),W=L(v);{var E=r=>{var e=tt(),s=x(K(e)),T=L(s,!0);I(s),B(()=>te(T,u())),y(r,e)};q(W,r=>{u()&&r(E)})}var b=x(W,2);{var w=r=>{var e=at();y(r,e)};q(b,r=>{m()&&r(w)})}I(v);var i=x(v,2);Ce(i,g),I(d),B(()=>te(S,l())),y(c,d)};let l=N(t,"title",3,""),u=N(t,"author",3,""),o=N(t,"coords",19,()=>[]),m=N(t,"recommended",3,!1),g=N(t,"html",3,"");const f=ae(l()),p=`#${f}`,R=l()+u()?` by ${u()}`:"",_=m()?Je:xe;let O=J(()=>ae(ve.state.title??"")===f);ue(()=>{var d;const c=((d=globalThis.location)==null?void 0:d.hash)??"";!ve.state.title&&c&&c===p&&Z().then(()=>re(p,{title:l()}))}),he(()=>{var c;a(O)&&((c=G("drawCallbacks"))==null||c.update(d=>[...d]),h.set(k))});const h=G("side");Re(M,{get setStyle(){return _},get coords(){return o()},get href(){return p},get title(){return R},onclick:c=>{c.preventDefault(),re(p,{title:l()})},get pinned(){return a(O)}}),le()}var lt=C("<!> <!>",1),it=C('<span title="recommended" class="svelte-37b3kl">ðŸŒŸ</span>'),nt=C('<li class="svelte-37b3kl"><a class="svelte-37b3kl"> </a> <!></li>'),ot=C('<h2 class="svelte-37b3kl">Books</h2> <ul class="book-list svelte-37b3kl"></ul>',1),ct=C('<h1 class="svelte-37b3kl"><!></h1> <!> <!>',1),dt=C('<button class="svelte-37b3kl">close</button> <!>',1),vt=C('<div class="container svelte-37b3kl"><!> <div class="sidebar svelte-37b3kl" style="margin: 1em "><!> <!> <br class="svelte-37b3kl"/> <hr class="svelte-37b3kl"/> <br class="svelte-37b3kl"/></div></div>');function pt(M,t){se(t,!0);const k=N(t,"side",3,null),l=N(t,"externalShapes",19,()=>[]),u=Y(k());X("side",u);let o=P(fe(k()??null));u.subscribe(h=>H(o,h??k()??null,!0)),ue(()=>{globalThis.addEventListener("hashchange",h=>{globalThis.location.hash||u.set(null)})});var m=vt();Ke("37b3kl",h=>{Be(()=>{Ge.title=ve.state.title??t.title??""})});var g=L(m);$e(g,{get title(){return t.title},get picture(){return t.picture},mapId:"shelves",children:(h,D)=>{var c=lt(),d=K(c);$(d,17,()=>t.books,ee,(S,v)=>{{let W=J(()=>a(v).recommended??!1),E=J(()=>a(v).author??"");st(S,{get title(){return a(v).title},get recommended(){return a(W)},get author(){return a(E)},get coords(){return a(v).coords},get html(){return a(v).html}})}});var j=x(d,2);$(j,17,l,ee,(S,v,W,E)=>{let b=()=>a(v).shape,w=()=>a(v).title,i=()=>a(v).href;{let r=J(()=>Se+(i()||""));Re(S,{get setStyle(){return xe},get coords(){return b()},get href(){return a(r)},onclick:e=>{e.preventDefault(),console.log("pushing state",{title:w()}),Ve(Se+i(),{state:{title:w()}})},get title(){return w()}})}}),y(h,c)},$$slots:{default:!0}});var f=x(g,2),p=L(f);Qe(p);var R=x(p,2);{var _=h=>{var D=ct(),c=K(D),d=L(c);{var j=b=>{var w=He(),i=K(w);Ce(i,()=>t.htmlTitle),y(b,w)},S=b=>{var w=Ie();B(()=>te(w,t.title)),y(b,w)};q(d,b=>{t.htmlTitle?b(j):b(S,!1)})}I(c);var v=x(c,2);de(v,()=>a(o)??ce);var W=x(v,2);{var E=b=>{var w=ot(),i=x(K(w),2);$(i,21,()=>t.books.filter(r=>!r.easter_egg).sort((r,e)=>r.title>e.title?1:-1),ee,(r,e)=>{var s=nt(),T=L(s);T.__click=A=>{A.preventDefault(),re(`#${ae(a(e).title??"")}`,{title:a(e).title})};var z=L(T,!0);I(T);var Q=x(T,2);{var ie=A=>{var ne=it();y(A,ne)};q(Q,A=>{a(e).recommended&&A(ie)})}I(s),B(A=>{n(T,"href",A),te(z,a(e).title)},[()=>`#${ae(a(e).title??"")}`]),y(r,s)}),I(i),y(b,w)};q(W,b=>{t.books.length>0&&b(E)})}y(h,D)},O=h=>{var D=dt(),c=K(D);c.__click=()=>{re("#",{}),u.set(k())};var d=x(c,2);de(d,()=>a(o)??ce),y(h,D)};q(R,h=>{a(o)===k()?h(_):h(O,!1)})}Fe(6),I(f),I(m),y(M,m),le()}pe(["click"]);export{pt as P};
