import{b as ue,e as qe,a as S,t as x,c as Re,d as De}from"./disclose-version.C6k04HHV.js";import{l as Ie,q as fe,y as ge,m as He,v as _e,ak as Te,ao as ze,am as Ae,A as Ee,ab as Le,o as Oe,p as ie,av as Z,G as H,i as a,aw as be,ax as G,I as B,b as he,t as j,a as le,au as $,ay as We,n as ce,c as L,r as T,s as k,k as Y,f as V,$ as je,az as Pe}from"./runtime.BLTbdMJA.js";import{e as N,r as we,d as pe,s as ae,h as Be}from"./render.BmwJMKKs.js";import{i as M}from"./if.C9bekPC2.js";import{e as ee,i as te,f as n,v as Fe,s as re,w as Ne,x as ke,H as Ge}from"./HamburgerNav.DazrFxjr.js";import{s as de}from"./snippet.CWH7aIAl.js";import{a as F,b as Q,p as O}from"./props.2E-vZ7p8.js";import{o as me,a as Me}from"./index-client.C-pQdCAW.js";import{b as ye}from"./paths.DLu3fkr5.js";import{w as U,a as se,g as Ve}from"./entry.BMKkJ--k.js";import{p as ve}from"./index.XdMDqFwq.js";function Ce(C,e,g,o,h){var v=C,_="",b;Ie(()=>{if(_===(_=e()??"")){fe&&ge();return}b!==void 0&&(Oe(b),b=void 0),_!==""&&(b=He(()=>{if(fe){_e.data;for(var m=ge(),p=m;m!==null&&(m.nodeType!==8||m.data!=="");)p=m,m=Te(m);if(m===null)throw ze(),Ae;ue(_e,p),v=Ee(m);return}var P=_+"",q=qe(P);ue(Le(q),q.lastChild),v.before(q)}))})}var Ye=x('<img class="enhanced-img svelte-y68h5g">'),Je=x("<source>"),Ke=x('<picture><!> <img class="enhanced-img svelte-y68h5g"></picture>'),Qe=x('<div class="container svelte-y68h5g"><map><!></map> <!> <canvas style="pointer-events: none" class="svelte-y68h5g"></canvas> <span class="svelte-y68h5g"></span></div>');function Ue(C,e){ie(e,!0);let g=1,o=null,h=B(null),v=null;const _=U(g);Z("ratioStore",_);const b=U(o);if(Z("canvasStore",b),b.subscribe(t=>{t&&H(m,F([...a(m)]))}),be("pageCanvas")){const t=G("pageCanvas");b.subscribe(r=>t.set(r))}if(be("pageRatio")){const t=G("pageRatio");_.subscribe(r=>t.set(r))}let m=B(F([])),p=U([]);Z("drawCallbacks",p),p.subscribe(t=>{H(m,F(t))}),he(()=>{if(!o){console.warn("no canvas found");return}const t=o.getContext("2d");if(!t){console.warn("no context found");return}t.clearRect(0,0,o.width,o.height),a(m).forEach(r=>r(t))});let P,q=B(!1),z=B(!1),f=B(!1),R=B(!1);const c=()=>{if(!v)throw new Error("img not found");a(q)&&(H(f,v.scrollLeft!=0),H(R,v.scrollLeft+v.clientWidth<v.scrollWidth))},d=()=>{var t;W(e.picture.img.w,((t=a(h))==null?void 0:t.width)||e.picture.img.w),o&&(o.width=a(h).width,o.height=a(h).height),v&&(v.scrollWidth>v.clientWidth?(H(q,!0),H(z,!1)):v.scrollHeight>v.clientHeight&&(H(q,!1),H(z,!0)),c())},W=(t,r)=>{g=t/(r||1),_.set(g)};me(()=>{const t=()=>{a(h)?d():$().then(t)};t();const r=()=>{o?b.set(o):$().then(r)};r(),$().then(()=>{console.log("updating draw callbacks"),p.update(I=>[...I])})});var D=Qe();N("resize",We,d);var w=L(D),y=L(w);de(y,()=>e.children??ce),T(w);var A=k(w,2);{var u=t=>{var r=Ye();Q(r,I=>H(h,I),()=>a(h)),j(()=>{n(r,"src",e.picture.img.src),n(r,"title",e.title),n(r,"alt",e.title),n(r,"usemap",`#${e.mapId??""}`),n(r,"width",e.picture.img.w),n(r,"height",e.picture.img.h)}),N("load",r,d),N("resize",r,d),we(r),S(t,r)},i=t=>{var r=Ke(),I=L(r);ee(I,17,()=>Object.entries(e.picture.sources),te,(J,X)=>{let K=()=>a(X)[0],ne=()=>a(X)[1];var oe=Je();j(()=>{n(oe,"srcset",ne()),n(oe,"type","image/"+K())}),S(J,oe)});var E=k(I,2);Q(E,J=>H(h,J),()=>a(h)),T(r),j(()=>{n(E,"src",e.picture.img.src),n(E,"title",e.title),n(E,"alt",e.title),n(E,"usemap",`#${e.mapId??""}`),n(E,"width",e.picture.img.w),n(E,"height",e.picture.img.h)}),N("load",E,d),N("resize",E,d),we(E),S(t,r)};M(A,t=>{typeof e.picture=="string"?t(u):t(i,!1)})}var s=k(A,2);Q(s,t=>o=t,()=>o);var l=k(s,2);Q(l,t=>P=t,()=>P),T(D),Q(D,t=>v=t,()=>v),j(()=>{n(D,"data-left",a(f)),n(D,"data-right",a(R)),n(w,"name",e.mapId),n(s,"width",e.picture.img.w),n(s,"height",e.picture.img.h)}),N("scroll",D,c),S(C,D),le()}const Se=C=>{},Xe=(C,e,g)=>{C.preventDefault(),e&&e.set(g)};var Ze=x('<area shape="poly">');function xe(C,e){ie(e,!0);const g=O(e,"href",3,""),o=O(e,"title",3,""),h=O(e,"coords",19,()=>[]),v=O(e,"onclick",3,()=>{}),_=O(e,"pinned",11,!1);let b=B(1);const m=G("ratioStore");let p=B(null);const P=G("canvasStore"),q=G("drawCallbacks"),z=s=>{Fe(s,a(d),e.setStyle)};z.title=o();const f=()=>{q.update(s=>s.filter(l=>l!==z).concat([z]))},R=()=>{q.update(s=>s.filter(l=>l!==z))};Me(()=>R());let c=B(F([...h()])),d=Y(()=>a(c).map(s=>s.map(l=>l/a(b)))),W=Y(()=>a(d).map(s=>s.join(",")).join(","));m.subscribe(s=>H(b,F(s))),P.subscribe(s=>H(p,F(s)));const D=()=>f(),w=()=>{_()||R()};he(()=>{_()?f():R()}),U(h()).subscribe(s=>H(c,F(s)));const A=G("side"),u=Se;var i=Ze();i.__click=function(...s){var l;(l=v())==null||l.apply(this,s)},i.__contextmenu=[Xe,A,u],n(i,"data-side-defined",!!Se),j(()=>{n(i,"coords",a(W)),n(i,"alt",o()),n(i,"title",o()),n(i,"href",g()),n(i,"data-ratio",a(b))}),N("mouseenter",i,D),N("mouseleave",i,w),S(C,i),le()}pe(["click","contextmenu"]);var $e=x("by <em> </em>",1),et=x("<span>ðŸŒŸ (recommended)</span>"),tt=x("<div><h1> </h1> <p><!> <!></p> <!></div>");function at(C,e){ie(e,!0);const g=c=>{var d=tt(),W=L(d),D=L(W,!0);T(W);var w=k(W,2),y=L(w);{var A=l=>{var t=$e(),r=k(V(t)),I=L(r,!0);T(r),j(()=>ae(I,h())),S(l,t)};M(y,l=>{h()&&l(A)})}var u=k(y,2);{var i=l=>{var t=et();S(l,t)};M(u,l=>{_()&&l(i)})}T(w);var s=k(w,2);Ce(s,b),T(d),j(()=>ae(D,o())),S(c,d)};let o=O(e,"title",3,""),h=O(e,"author",3,""),v=O(e,"coords",19,()=>[]),_=O(e,"recommended",3,!1),b=O(e,"html",3,"");const m=re(o()),p=`#${m}`,P=o()+h()?` by ${h()}`:"",q=_()?Ne:ke;let z=Y(()=>re(ve.state.title??"")===m);me(()=>{var d;const c=((d=globalThis.location)==null?void 0:d.hash)??"";!ve.state.title&&c&&c===p&&$().then(()=>se(p,{title:o()}))}),he(()=>{var c;a(z)&&((c=G("drawCallbacks"))==null||c.update(d=>[...d]),f.set(g))});const f=G("side");xe(C,{setStyle:q,get coords(){return v()},href:p,title:P,onclick:c=>{c.preventDefault(),se(p,{title:o()})},get pinned(){return a(z)}}),le()}var rt=x("<!> <!>",1),st=(C,e)=>{C.preventDefault(),se(`#${re(a(e).title??"")}`,{title:a(e).title})},it=x('<span title="recommended" class="svelte-mqhbgc">ðŸŒŸ</span>'),lt=x('<li class="svelte-mqhbgc"><a class="svelte-mqhbgc"> </a> <!></li>'),nt=x('<h2 class="svelte-mqhbgc">Books</h2> <ul class="book-list svelte-mqhbgc"></ul>',1),ot=x('<h1 class="svelte-mqhbgc"><!></h1> <!> <!>',1),ct=(C,e,g)=>{se("#",{}),e.set(g())},dt=x('<button class="svelte-mqhbgc">close</button> <!>',1),vt=x('<div class="container svelte-mqhbgc"><!> <div class="sidebar svelte-mqhbgc" style="margin: 1em "><!> <!> <br class="svelte-mqhbgc"> <hr class="svelte-mqhbgc"> <br class="svelte-mqhbgc"></div></div>');function kt(C,e){ie(e,!0);const g=O(e,"side",3,null),o=O(e,"externalShapes",19,()=>[]),h=U(g());Z("side",h);let v=B(F(g()??null));h.subscribe(f=>H(v,F(f??g()??null))),me(()=>{globalThis.addEventListener("hashchange",f=>{globalThis.location.hash||h.set(null)})});var _=vt();Be(f=>{j(()=>je.title=ve.state.title??e.title)});var b=L(_);Ue(b,{get title(){return e.title},get picture(){return e.picture},mapId:"shelves",children:(f,R)=>{var c=rt(),d=V(c);ee(d,17,()=>e.books,te,(w,y)=>{var A=Y(()=>a(y).recommended??!1),u=Y(()=>a(y).author??"");at(w,{get title(){return a(y).title},get recommended(){return a(A)},get author(){return a(u)},get coords(){return a(y).coords},get html(){return a(y).html}})});var W=k(d,2);ee(W,17,o,te,(w,y)=>{let A=()=>a(y).shape,u=()=>a(y).title,i=()=>a(y).href;var s=Y(()=>ye+(i()||""));xe(w,{setStyle:ke,get coords(){return A()},get href(){return a(s)},onclick:l=>{l.preventDefault(),console.log("pushing state",{title:u()}),Ve(ye+i(),{state:{title:u()}})},get title(){return u()}})}),S(f,c)},$$slots:{default:!0}});var m=k(b,2),p=L(m);Ge(p);var P=k(p,2);{var q=f=>{var R=ot(),c=V(R),d=L(c);{var W=u=>{var i=Re(),s=V(i);Ce(s,()=>e.htmlTitle),S(u,i)},D=u=>{var i=De();j(()=>ae(i,e.title)),S(u,i)};M(d,u=>{e.htmlTitle?u(W):u(D,!1)})}T(c);var w=k(c,2);de(w,()=>a(v)??ce);var y=k(w,2);{var A=u=>{var i=nt(),s=k(V(i),2);ee(s,21,()=>e.books.filter(l=>!l.easter_egg).sort((l,t)=>l.title>t.title?1:-1),te,(l,t)=>{var r=lt(),I=L(r);I.__click=[st,t],j(()=>n(I,"href",`#${re(a(t).title??"")}`));var E=L(I,!0);T(I);var J=k(I,2);{var X=K=>{var ne=it();S(K,ne)};M(J,K=>{a(t).recommended&&K(X)})}T(r),j(()=>ae(E,a(t).title)),S(l,r)}),T(s),S(u,i)};M(y,u=>{e.books.length>0&&u(A)})}S(f,R)},z=f=>{var R=dt(),c=V(R);c.__click=[ct,h,g];var d=k(c,2);de(d,()=>a(v)??ce),S(f,R)};M(P,f=>{a(v)===g()?f(q):f(z,!1)})}Pe(6),T(m),T(_),S(C,_),le()}pe(["click"]);export{kt as P};
