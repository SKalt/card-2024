import{b as fe,e as Re,a as k,t as C,c as De,d as Ie}from"./disclose-version.C6k04HHV.js";import{l as He,q as me,y as ge,m as Te,v as _e,ak as ze,ao as Ae,am as Ee,A as Le,ab as Oe,o as We,p as ie,av as Z,G as T,i as a,aw as be,ax as G,I as F,b as he,t as P,a as le,au as $,ay as je,n as ce,c as O,r as z,s as p,k as Y,f as V,$ as Pe}from"./runtime.BLTbdMJA.js";import{e as q,r as we,d as Se,s as ae,h as Be}from"./render.BmwJMKKs.js";import{i as M}from"./if.C9bekPC2.js";import{e as ee,i as te,f as n,v as Fe,s as re,w as Ne,x as pe,H as qe}from"./HamburgerNav.Cj6-_GWS.js";import{s as ve}from"./snippet.CWH7aIAl.js";import{a as N,b as Q,p as W}from"./props.2E-vZ7p8.js";import{o as ue,a as Ge}from"./index-client.C-pQdCAW.js";import{b as ye}from"./paths.3ZvTI56n.js";import{w as U,a as se,g as Me}from"./entry.D7PyrVjv.js";import{p as de}from"./index.DFOQPgwe.js";function xe(x,e,g,o,h){var d=x,_="",b;He(()=>{if(_===(_=e()??"")){me&&ge();return}b!==void 0&&(We(b),b=void 0),_!==""&&(b=Te(()=>{if(me){_e.data;for(var u=ge(),S=u;u!==null&&(u.nodeType!==8||u.data!=="");)S=u,u=ze(u);if(u===null)throw Ae(),Ee;fe(_e,S),d=Le(u);return}var B=_+"",R=Re(B);fe(Oe(R),R.lastChild),d.before(R)}))})}var Ve=C('<img class="enhanced-img svelte-y68h5g">'),Ye=C("<source>"),Je=C('<picture><!> <img class="enhanced-img svelte-y68h5g"></picture>'),Ke=C('<div class="container svelte-y68h5g"><map><!></map> <!> <canvas style="pointer-events: none" class="svelte-y68h5g"></canvas> <span class="svelte-y68h5g"></span></div>');function Qe(x,e){ie(e,!0);let g=1,o=null,h=F(null),d=null;const _=U(g);Z("ratioStore",_);const b=U(o);if(Z("canvasStore",b),b.subscribe(t=>{t&&T(u,N([...a(u)]))}),be("pageCanvas")){const t=G("pageCanvas");b.subscribe(r=>t.set(r))}if(be("pageRatio")){const t=G("pageRatio");_.subscribe(r=>t.set(r))}let u=F(N([])),S=U([]);Z("drawCallbacks",S),S.subscribe(t=>{T(u,N(t))}),he(()=>{if(!o){console.warn("no canvas found");return}const t=o.getContext("2d");if(!t){console.warn("no context found");return}t.clearRect(0,0,o.width,o.height),a(u).forEach(r=>r(t))});let B,R=F(!1),A=F(!1),m=F(!1),D=F(!1);const c=()=>{if(!d)throw new Error("img not found");a(R)&&(T(m,d.scrollLeft!=0),T(D,d.scrollLeft+d.clientWidth<d.scrollWidth))},v=()=>{var t;j(e.picture.img.w,((t=a(h))==null?void 0:t.width)||e.picture.img.w),o&&(o.width=a(h).width,o.height=a(h).height),d&&(d.scrollWidth>d.clientWidth?(T(R,!0),T(A,!1)):d.scrollHeight>d.clientHeight&&(T(R,!1),T(A,!0)),c())},j=(t,r)=>{g=t/(r||1),_.set(g)};ue(()=>{const t=()=>{a(h)?v():$().then(t)};t();const r=()=>{o?b.set(o):$().then(r)};r(),$().then(()=>{console.log("updating draw callbacks"),S.update(H=>[...H])})});var I=Ke();q("resize",je,v);var w=O(I),y=O(w);ve(y,()=>e.children??ce),z(w);var E=p(w,2);{var f=t=>{var r=Ve();Q(r,H=>T(h,H),()=>a(h)),P(()=>{n(r,"src",e.picture.img.src),n(r,"title",e.title),n(r,"alt",e.title),n(r,"usemap",`#${e.mapId??""}`),n(r,"width",e.picture.img.w),n(r,"height",e.picture.img.h)}),q("load",r,v),q("resize",r,v),we(r),k(t,r)},i=t=>{var r=Je(),H=O(r);ee(H,17,()=>Object.entries(e.picture.sources),te,(J,X)=>{let K=()=>a(X)[0],ne=()=>a(X)[1];var oe=Ye();P(()=>{n(oe,"srcset",ne()),n(oe,"type","image/"+K())}),k(J,oe)});var L=p(H,2);Q(L,J=>T(h,J),()=>a(h)),z(r),P(()=>{n(L,"src",e.picture.img.src),n(L,"title",e.title),n(L,"alt",e.title),n(L,"usemap",`#${e.mapId??""}`),n(L,"width",e.picture.img.w),n(L,"height",e.picture.img.h)}),q("load",L,v),q("resize",L,v),we(L),k(t,r)};M(E,t=>{typeof e.picture=="string"?t(f):t(i,!1)})}var s=p(E,2);Q(s,t=>o=t,()=>o);var l=p(s,2);Q(l,t=>B=t,()=>B),z(I),Q(I,t=>d=t,()=>d),P(()=>{n(I,"data-left",a(m)),n(I,"data-right",a(D)),n(w,"name",e.mapId),n(s,"width",e.picture.img.w),n(s,"height",e.picture.img.h)}),q("scroll",I,c),k(x,I),le()}const ke=x=>{},Ue=(x,e,g)=>{x.preventDefault(),e&&e.set(g)};var Xe=C('<area shape="poly">');function Ce(x,e){ie(e,!0);const g=W(e,"href",3,""),o=W(e,"title",3,""),h=W(e,"coords",19,()=>[]),d=W(e,"onclick",3,()=>{}),_=W(e,"pinned",11,!1);let b=F(1);const u=G("ratioStore");let S=F(null);const B=G("canvasStore"),R=G("drawCallbacks"),A=s=>{Fe(s,a(v),e.setStyle)};A.title=o();const m=()=>{R.update(s=>s.filter(l=>l!==A).concat([A]))},D=()=>{R.update(s=>s.filter(l=>l!==A))};Ge(()=>D());let c=F(N([...h()])),v=Y(()=>a(c).map(s=>s.map(l=>l/a(b)))),j=Y(()=>a(v).map(s=>s.join(",")).join(","));u.subscribe(s=>T(b,N(s))),B.subscribe(s=>T(S,N(s)));const I=()=>m(),w=()=>{_()||D()};he(()=>{_()?m():D()}),U(h()).subscribe(s=>T(c,N(s)));const E=G("side"),f=ke;var i=Xe();i.__click=function(...s){var l;(l=d())==null||l.apply(this,s)},i.__contextmenu=[Ue,E,f],n(i,"data-side-defined",!!ke),P(()=>{n(i,"coords",a(j)),n(i,"alt",o()),n(i,"title",o()),n(i,"href",g()),n(i,"data-ratio",a(b))}),q("mouseenter",i,I),q("mouseleave",i,w),k(x,i),le()}Se(["click","contextmenu"]);var Ze=C("by <em> </em>",1),$e=C("<span>ðŸŒŸ (recommended)</span>"),et=C("<div><h1> </h1> <p><!> <!></p> <!></div>");function tt(x,e){ie(e,!0);const g=c=>{var v=et(),j=O(v),I=O(j,!0);z(j);var w=p(j,2),y=O(w);{var E=l=>{var t=Ze(),r=p(V(t)),H=O(r,!0);z(r),P(()=>ae(H,h())),k(l,t)};M(y,l=>{h()&&l(E)})}var f=p(y,2);{var i=l=>{var t=$e();k(l,t)};M(f,l=>{_()&&l(i)})}z(w);var s=p(w,2);xe(s,b),z(v),P(()=>ae(I,o())),k(c,v)};let o=W(e,"title",3,""),h=W(e,"author",3,""),d=W(e,"coords",19,()=>[]),_=W(e,"recommended",3,!1),b=W(e,"html",3,"");const u=re(o()),S=`#${u}`,B=o()+h()?` by ${h()}`:"",R=_()?Ne:pe;let A=Y(()=>re(de.state.title??"")===u);ue(()=>{var v;const c=((v=globalThis.location)==null?void 0:v.hash)??"";!de.state.title&&c&&c===S&&$().then(()=>se(S,{title:o()}))}),he(()=>{var c;a(A)&&((c=G("drawCallbacks"))==null||c.update(v=>[...v]),m.set(g))});const m=G("side");Ce(x,{setStyle:R,get coords(){return d()},href:S,title:B,onclick:c=>{c.preventDefault(),se(S,{title:o()})},get pinned(){return a(A)}}),le()}var at=C("<!> <!>",1),rt=(x,e)=>{x.preventDefault(),se(`#${re(a(e).title??"")}`,{title:a(e).title})},st=C('<span title="recommended" class="svelte-kxvivo">ðŸŒŸ</span>'),it=C('<li class="svelte-kxvivo"><a class="svelte-kxvivo"> </a> <!></li>'),lt=C('<h2 class="svelte-kxvivo">Books</h2> <ul class="book-list svelte-kxvivo"></ul>',1),nt=C('<h1 class="svelte-kxvivo"><!></h1> <!> <!>',1),ot=(x,e,g)=>{se("#",{}),e.set(g())},ct=C('<button class="svelte-kxvivo">close</button> <!>',1),vt=C('<div class="container svelte-kxvivo"><!> <div class="sidebar svelte-kxvivo" style="margin: 1em "><!> <!></div></div>');function St(x,e){ie(e,!0);const g=W(e,"side",3,null),o=W(e,"externalShapes",19,()=>[]),h=U(g());Z("side",h);let d=F(N(g()??null));h.subscribe(m=>T(d,N(m??g()??null))),ue(()=>{globalThis.addEventListener("hashchange",m=>{globalThis.location.hash||h.set(null)})});var _=vt();Be(m=>{P(()=>Pe.title=de.state.title??e.title)});var b=O(_);Qe(b,{get title(){return e.title},get picture(){return e.picture},mapId:"shelves",children:(m,D)=>{var c=at(),v=V(c);ee(v,17,()=>e.books,te,(w,y)=>{var E=Y(()=>a(y).recommended??!1),f=Y(()=>a(y).author??"");tt(w,{get title(){return a(y).title},get recommended(){return a(E)},get author(){return a(f)},get coords(){return a(y).coords},get html(){return a(y).html}})});var j=p(v,2);ee(j,17,o,te,(w,y)=>{let E=()=>a(y).shape,f=()=>a(y).title,i=()=>a(y).href;var s=Y(()=>ye+(i()||""));Ce(w,{setStyle:pe,get coords(){return E()},get href(){return a(s)},onclick:l=>{l.preventDefault(),console.log("pushing state",{title:f()}),Me(ye+i(),{state:{title:f()}})},get title(){return f()}})}),k(m,c)},$$slots:{default:!0}});var u=p(b,2),S=O(u);qe(S);var B=p(S,2);{var R=m=>{var D=nt(),c=V(D),v=O(c);{var j=f=>{var i=De(),s=V(i);xe(s,()=>e.htmlTitle),k(f,i)},I=f=>{var i=Ie();P(()=>ae(i,e.title)),k(f,i)};M(v,f=>{e.htmlTitle?f(j):f(I,!1)})}z(c);var w=p(c,2);ve(w,()=>a(d)??ce);var y=p(w,2);{var E=f=>{var i=lt(),s=p(V(i),2);ee(s,21,()=>e.books.filter(l=>!l.easter_egg).sort((l,t)=>l.title>t.title?1:-1),te,(l,t)=>{var r=it(),H=O(r);H.__click=[rt,t],P(()=>n(H,"href",`#${re(a(t).title??"")}`));var L=O(H,!0);z(H);var J=p(H,2);{var X=K=>{var ne=st();k(K,ne)};M(J,K=>{a(t).recommended&&K(X)})}z(r),P(()=>ae(L,a(t).title)),k(l,r)}),z(s),k(f,i)};M(y,f=>{e.books.length>0&&f(E)})}k(m,D)},A=m=>{var D=ct(),c=V(D);c.__click=[ot,h,g];var v=p(c,2);ve(v,()=>a(d)??ce),k(m,D)};M(B,m=>{a(d)===g()?m(R):m(A,!1)})}z(u),z(_),k(x,_),le()}Se(["click"]);export{St as P};
